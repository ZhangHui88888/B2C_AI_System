# ç¯å¢ƒå˜é‡é…ç½®æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰ç¯å¢ƒå˜é‡åŠå…¶é…ç½®æ–¹æ³•

---

## å‰ç«¯ç¯å¢ƒå˜é‡ (frontend/.env)

### Supabase é…ç½®

```env
# Supabase é¡¹ç›® URL
# è·å–æ–¹å¼ï¼šSupabase Dashboard > Settings > API > Project URL
# ç¤ºä¾‹ï¼šhttps://xxxxxxxxxxxxx.supabase.co
PUBLIC_SUPABASE_URL=your-supabase-url

# Supabase åŒ¿åå¯†é’¥ï¼ˆAnon Keyï¼‰
# è·å–æ–¹å¼ï¼šSupabase Dashboard > Settings > API > Project API keys > anon public
# è¯´æ˜ï¼šæ­¤å¯†é’¥å¯ä»¥å®‰å…¨åœ°åœ¨å‰ç«¯ä½¿ç”¨ï¼Œå— RLS ç­–ç•¥ä¿æŠ¤
# ç¤ºä¾‹ï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### Stripe é…ç½®

```env
# Stripe å¯å‘å¸ƒå¯†é’¥ï¼ˆPublishable Keyï¼‰
# è·å–æ–¹å¼ï¼šStripe Dashboard > Developers > API keys > Publishable key
# è¯´æ˜ï¼šæ­¤å¯†é’¥å¯ä»¥å®‰å…¨åœ°åœ¨å‰ç«¯ä½¿ç”¨
# æµ‹è¯•ç¯å¢ƒä»¥ pk_test_ å¼€å¤´ï¼Œç”Ÿäº§ç¯å¢ƒä»¥ pk_live_ å¼€å¤´
# ç¤ºä¾‹ï¼špk_test_51xxxxxxxxxxxxx
PUBLIC_STRIPE_PUBLISHABLE_KEY=your-stripe-key
```

### ç«™ç‚¹é…ç½®

```env
# ç«™ç‚¹ URLï¼ˆå‰ç«¯éƒ¨ç½²åœ°å€ï¼‰
# å¼€å‘ç¯å¢ƒï¼šhttp://localhost:4321
# ç”Ÿäº§ç¯å¢ƒï¼šhttps://your-domain.com
# è¯´æ˜ï¼šç”¨äºç”Ÿæˆ canonical URLã€sitemapã€Open Graph ç­‰
PUBLIC_SITE_URL=https://your-domain.com

# API æœåŠ¡åœ°å€ï¼ˆCloudflare Workers åœ°å€ï¼‰
# å¼€å‘ç¯å¢ƒï¼šhttp://localhost:8787
# ç”Ÿäº§ç¯å¢ƒï¼šhttps://api.your-domain.com
# è¯´æ˜ï¼šå‰ç«¯è°ƒç”¨åç«¯ API çš„åŸºç¡€ URL
PUBLIC_API_URL=https://api.your-domain.com

# ç«™ç‚¹åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º "DTC Store"ï¼‰
# è¯´æ˜ï¼šæ˜¾ç¤ºåœ¨é¡µé¢æ ‡é¢˜ã€å¯¼èˆªæ ç­‰ä½ç½®
# ç¤ºä¾‹ï¼šTechGearã€BeautyGlow
PUBLIC_SITE_NAME=DTC Store
```

---

## åç«¯ç¯å¢ƒå˜é‡ (worker/wrangler.toml + Secrets)

### Supabase é…ç½®

```bash
# Supabase é¡¹ç›® URL
# è·å–æ–¹å¼ï¼šSupabase Dashboard > Settings > API > Project URL
# é…ç½®æ–¹å¼ï¼šwrangler secret put SUPABASE_URL
wrangler secret put SUPABASE_URL
# è¾“å…¥ï¼šhttps://xxxxxxxxxxxxx.supabase.co

# Supabase æœåŠ¡ç«¯å¯†é’¥ï¼ˆService Role Keyï¼‰
# è·å–æ–¹å¼ï¼šSupabase Dashboard > Settings > API > Project API keys > service_role secret
# è¯´æ˜ï¼šæ­¤å¯†é’¥æ‹¥æœ‰å®Œå…¨æƒé™ï¼Œç»•è¿‡ RLS ç­–ç•¥ï¼Œä»…åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œåˆ‡å‹¿æ³„éœ²
# é…ç½®æ–¹å¼ï¼šwrangler secret put SUPABASE_SERVICE_KEY
wrangler secret put SUPABASE_SERVICE_KEY
# è¾“å…¥ï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Stripe é…ç½®

```bash
# Stripe å¯†é’¥ï¼ˆSecret Keyï¼‰
# è·å–æ–¹å¼ï¼šStripe Dashboard > Developers > API keys > Secret key
# è¯´æ˜ï¼šæ­¤å¯†é’¥ç”¨äºæœåŠ¡ç«¯åˆ›å»º PaymentIntentã€å¤„ç†é€€æ¬¾ç­‰æ“ä½œ
# æµ‹è¯•ç¯å¢ƒä»¥ sk_test_ å¼€å¤´ï¼Œç”Ÿäº§ç¯å¢ƒä»¥ sk_live_ å¼€å¤´
# é…ç½®æ–¹å¼ï¼šwrangler secret put STRIPE_SECRET_KEY
wrangler secret put STRIPE_SECRET_KEY
# è¾“å…¥ï¼šsk_test_51xxxxxxxxxxxxx

# Stripe Webhook ç­¾åå¯†é’¥ï¼ˆWebhook Secretï¼‰
# è·å–æ–¹å¼ï¼šStripe Dashboard > Developers > Webhooks > æ·»åŠ ç«¯ç‚¹åè·å–ç­¾åå¯†é’¥
# è¯´æ˜ï¼šç”¨äºéªŒè¯ Webhook è¯·æ±‚çš„çœŸå®æ€§ï¼Œé˜²æ­¢ä¼ªé€ 
# ä»¥ whsec_ å¼€å¤´
# é…ç½®æ–¹å¼ï¼šwrangler secret put STRIPE_WEBHOOK_SECRET
wrangler secret put STRIPE_WEBHOOK_SECRET
# è¾“å…¥ï¼šwhsec_xxxxxxxxxxxxx
```

### DeepSeek AI é…ç½®

```bash
# DeepSeek API å¯†é’¥
# è·å–æ–¹å¼ï¼šDeepSeek å®˜ç½‘ > API Keys
# è¯´æ˜ï¼šç”¨äº AI å®¢æœå¯¹è¯ã€å†…å®¹ç”Ÿæˆã€å‘é‡ Embedding
# é…ç½®æ–¹å¼ï¼šwrangler secret put DEEPSEEK_API_KEY
wrangler secret put DEEPSEEK_API_KEY
# è¾“å…¥ï¼šsk-xxxxxxxxxxxxx
```

### Resend é‚®ä»¶é…ç½®

```bash
# Resend API å¯†é’¥
# è·å–æ–¹å¼ï¼šResend Dashboard > API Keys
# è¯´æ˜ï¼šç”¨äºå‘é€è®¢å•ç¡®è®¤ã€å‘è´§é€šçŸ¥ç­‰äº¤æ˜“é‚®ä»¶
# é…ç½®æ–¹å¼ï¼šwrangler secret put RESEND_API_KEY
wrangler secret put RESEND_API_KEY
# è¾“å…¥ï¼šre_xxxxxxxxxxxxx
```

### å¤šå“ç‰Œé…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
# é»˜è®¤å“ç‰Œ Slug
# è¯´æ˜ï¼šä»…åœ¨å¼€å‘ç¯å¢ƒï¼ˆlocalhostï¼‰ä½¿ç”¨ï¼Œå½“åŸŸåæ— æ³•åŒ¹é…æ—¶å›é€€åˆ°æ­¤å“ç‰Œ
# ç”Ÿäº§ç¯å¢ƒä¼šå¿½ç•¥æ­¤é…ç½®ï¼ŒæœªåŒ¹é…åŸŸåç›´æ¥è¿”å› 404
# é…ç½®æ–¹å¼ï¼šåœ¨ wrangler.toml çš„ [vars] ä¸­é…ç½®
# ç¤ºä¾‹ï¼šdefault-brand
DEFAULT_BRAND_SLUG=default-brand
```

---

## wrangler.toml é…ç½®ç¤ºä¾‹

```toml
name = "b2c-ai-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# ç¯å¢ƒå˜é‡ï¼ˆéæ•æ„Ÿä¿¡æ¯ï¼‰
[vars]
DEFAULT_BRAND_SLUG = "default-brand"  # å¼€å‘ç¯å¢ƒé»˜è®¤å“ç‰Œ

# KV å‘½åç©ºé—´ç»‘å®šï¼ˆå¯é€‰ï¼Œç”¨äºå“ç‰Œä¿¡æ¯ç¼“å­˜ï¼‰
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"
preview_id = "your-preview-kv-namespace-id"

# Vectorize ç´¢å¼•ç»‘å®šï¼ˆå¯é€‰ï¼Œç”¨äº AI å‘é‡æ£€ç´¢ï¼‰
[[vectorize]]
binding = "VECTORIZE"
index_name = "knowledge-base"
```

---

## é…ç½®æ­¥éª¤

### 1. å‰ç«¯é…ç½®

```bash
cd frontend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å®é™…å€¼
```

### 2. åç«¯é…ç½®

```bash
cd worker

# é…ç½®æ‰€æœ‰ Secretsï¼ˆæŒ‰æç¤ºè¾“å…¥å®é™…å€¼ï¼‰
wrangler secret put SUPABASE_URL
wrangler secret put SUPABASE_SERVICE_KEY
wrangler secret put STRIPE_SECRET_KEY
wrangler secret put STRIPE_WEBHOOK_SECRET
wrangler secret put DEEPSEEK_API_KEY
wrangler secret put RESEND_API_KEY

# ç¼–è¾‘ wrangler.tomlï¼Œé…ç½® KV å’Œ Vectorizeï¼ˆå¦‚éœ€è¦ï¼‰
```

### 3. éªŒè¯é…ç½®

```bash
# å‰ç«¯
cd frontend
npm run dev
# è®¿é—® http://localhost:4321ï¼Œæ£€æŸ¥æ˜¯å¦æ­£å¸¸åŠ è½½

# åç«¯
cd worker
npm run dev
# è®¿é—® http://localhost:8787/api/healthï¼Œåº”è¿”å› {"status": "ok"}
```

---

## ç¯å¢ƒåŒºåˆ†

### å¼€å‘ç¯å¢ƒ (Development)
- å‰ç«¯ï¼š`http://localhost:4321`
- åç«¯ï¼š`http://localhost:8787`
- ä½¿ç”¨ Stripe æµ‹è¯•å¯†é’¥ï¼ˆpk_test_ã€sk_test_ï¼‰
- å…è®¸ `DEFAULT_BRAND_SLUG` å›é€€

### ç”Ÿäº§ç¯å¢ƒ (Production)
- å‰ç«¯ï¼šé€šè¿‡ Cloudflare Pages éƒ¨ç½²
- åç«¯ï¼šé€šè¿‡ Cloudflare Workers éƒ¨ç½²
- ä½¿ç”¨ Stripe ç”Ÿäº§å¯†é’¥ï¼ˆpk_live_ã€sk_live_ï¼‰
- ç¦ç”¨ `DEFAULT_BRAND_SLUG` å›é€€ï¼ŒæœªåŒ¹é…åŸŸåè¿”å› 404

---

## å®‰å…¨æ³¨æ„äº‹é¡¹

### âš ï¸ åˆ‡å‹¿æ³„éœ²çš„å¯†é’¥
- `SUPABASE_SERVICE_KEY`ï¼šæ‹¥æœ‰å®Œå…¨æ•°æ®åº“æƒé™
- `STRIPE_SECRET_KEY`ï¼šå¯ä»¥åˆ›å»ºæ”¯ä»˜ã€é€€æ¬¾
- `STRIPE_WEBHOOK_SECRET`ï¼šç”¨äºéªŒè¯ Webhook çœŸå®æ€§
- `DEEPSEEK_API_KEY`ï¼šä¼šäº§ç”Ÿ API è´¹ç”¨
- `RESEND_API_KEY`ï¼šå¯ä»¥å‘é€é‚®ä»¶

### âœ… å¯ä»¥å…¬å¼€çš„å¯†é’¥
- `PUBLIC_SUPABASE_URL`ï¼šå…¬å¼€çš„é¡¹ç›® URL
- `PUBLIC_SUPABASE_ANON_KEY`ï¼šå— RLS ç­–ç•¥ä¿æŠ¤
- `PUBLIC_STRIPE_PUBLISHABLE_KEY`ï¼šä»…ç”¨äºå‰ç«¯åˆ›å»ºæ”¯ä»˜è¡¨å•

### ğŸ”’ æœ€ä½³å®è·µ
1. ä½¿ç”¨ `.gitignore` å¿½ç•¥ `.env` æ–‡ä»¶
2. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Cloudflare Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯
3. å®šæœŸè½®æ¢ API å¯†é’¥
4. æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥
5. ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ä»»ä½•å¯†é’¥

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æŸ¥çœ‹å·²é…ç½®çš„ Secretsï¼Ÿ
```bash
wrangler secret list
```

### Q: å¦‚ä½•åˆ é™¤æŸä¸ª Secretï¼Ÿ
```bash
wrangler secret delete SECRET_NAME
```

### Q: æœ¬åœ°å¼€å‘æ—¶å¦‚ä½•ä½¿ç”¨ Secretsï¼Ÿ
åˆ›å»º `.dev.vars` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ° Gitï¼‰ï¼š
```env
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx
DEEPSEEK_API_KEY=sk-xxxxx
RESEND_API_KEY=re_xxxxx
```

### Q: Stripe Webhook å¦‚ä½•é…ç½®ï¼Ÿ
1. ç™»å½• Stripe Dashboard
2. è¿›å…¥ Developers > Webhooks
3. æ·»åŠ ç«¯ç‚¹ï¼š`https://api.your-domain.com/api/stripe/webhook`
4. é€‰æ‹©äº‹ä»¶ï¼š`payment_intent.succeeded`ã€`payment_intent.payment_failed`
5. å¤åˆ¶ç­¾åå¯†é’¥åˆ° `STRIPE_WEBHOOK_SECRET`

---

## æ›´æ–°æ—¥å¿—

- 2025-12-25ï¼šåˆå§‹ç‰ˆæœ¬