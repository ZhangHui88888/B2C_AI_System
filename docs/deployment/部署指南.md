# éƒ¨ç½²ä¸é…ç½®å®Œæ•´æŒ‡å—

> æœ¬æ–‡æ¡£æä¾› DTC ç‹¬ç«‹ç«™ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²æµç¨‹å’Œç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
3. [æ•°æ®åº“éƒ¨ç½²](#æ•°æ®åº“éƒ¨ç½²)
4. [åç«¯éƒ¨ç½²](#åç«¯éƒ¨ç½²)
5. [å‰ç«¯éƒ¨ç½²](#å‰ç«¯éƒ¨ç½²)
6. [ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®](#ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®)
7. [å¤šå“ç‰Œé…ç½®](#å¤šå“ç‰Œé…ç½®)
8. [æœ¬åœ°å¼€å‘](#æœ¬åœ°å¼€å‘)
9. [ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•](#ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•)
10. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare    â”‚     â”‚    Supabase     â”‚     â”‚     Stripe      â”‚
â”‚    Workers      â”‚â”€â”€â”€â”€â–¶â”‚   PostgreSQL    â”‚     â”‚    Payments     â”‚
â”‚   (API å±‚)      â”‚     â”‚   + pgvector    â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare    â”‚     â”‚     Resend      â”‚     â”‚    DeepSeek     â”‚
â”‚     Pages       â”‚     â”‚     Email       â”‚     â”‚    AI API       â”‚
â”‚   (å‰ç«¯)        â”‚     â”‚                 â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯æ ˆï¼š**
- **å‰ç«¯**: Astro + TypeScript + TailwindCSS
- **åç«¯**: Cloudflare Workers
- **æ•°æ®åº“**: Supabase (PostgreSQL + pgvector)
- **æ”¯ä»˜**: Stripe
- **é‚®ä»¶**: Resend
- **AI**: DeepSeek

---

## ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡

#### åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cd frontend
cp .env.example .env
```

#### å¿…éœ€çš„ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|--------|
| `PUBLIC_SUPABASE_URL` | âœ… | Supabase é¡¹ç›® URL | `https://xxx.supabase.co` |
| `PUBLIC_SUPABASE_ANON_KEY` | âœ… | Supabase åŒ¿åå¯†é’¥ | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` |
| `PUBLIC_API_URL` | âœ… | Worker API åœ°å€ | `https://api.yourstore.com` |
| `PUBLIC_SITE_URL` | âœ… | ç½‘ç«™åœ°å€ | `https://yourstore.com` |
| `PUBLIC_SITE_NAME` | âœ… | ç½‘ç«™åç§° | `My Store` |
| `PUBLIC_STRIPE_PUBLISHABLE_KEY` | âœ… | Stripe å…¬é’¥ | `pk_live_...` æˆ– `pk_test_...` |

#### é…ç½®ç¤ºä¾‹ (frontend/.env)

```env
# Supabase é…ç½®
# è·å–æ–¹å¼ï¼šSupabase Dashboard > Settings > API
PUBLIC_SUPABASE_URL=https://xxxxxxxxxxxxx.supabase.co
PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Stripe é…ç½®
# è·å–æ–¹å¼ï¼šStripe Dashboard > Developers > API keys
# æµ‹è¯•ç¯å¢ƒç”¨ pk_test_ï¼Œç”Ÿäº§ç¯å¢ƒç”¨ pk_live_
PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51xxxxxxxxxxxxx

# ç«™ç‚¹é…ç½®
PUBLIC_SITE_URL=https://yourstore.com
PUBLIC_API_URL=https://api.yourstore.com
PUBLIC_SITE_NAME=My Store
```

### åç«¯ç¯å¢ƒå˜é‡ (Secrets)

åç«¯ä½¿ç”¨ Cloudflare Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œé€šè¿‡ `wrangler` CLI é…ç½®ã€‚

#### é…ç½®æ‰€æœ‰ Secrets

```bash
cd worker

# Supabase é…ç½®
wrangler secret put SUPABASE_URL
# è¾“å…¥ï¼šhttps://xxxxxxxxxxxxx.supabase.co

wrangler secret put SUPABASE_SERVICE_KEY
# è¾“å…¥ï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...ï¼ˆservice_role keyï¼‰

# Stripe é…ç½®
wrangler secret put STRIPE_SECRET_KEY
# è¾“å…¥ï¼šsk_test_51xxxxxxxxxxxxxï¼ˆæµ‹è¯•ï¼‰æˆ– sk_live_...ï¼ˆç”Ÿäº§ï¼‰

wrangler secret put STRIPE_WEBHOOK_SECRET
# è¾“å…¥ï¼šwhsec_xxxxxxxxxxxxx

# DeepSeek AI é…ç½®ï¼ˆAI å®¢æœåŠŸèƒ½ï¼‰
wrangler secret put DEEPSEEK_API_KEY
# è¾“å…¥ï¼šsk-xxxxxxxxxxxxx

# Resend é‚®ä»¶é…ç½®
wrangler secret put RESEND_API_KEY
# è¾“å…¥ï¼šre_xxxxxxxxxxxxx

# é€šçŸ¥é‚®ç®±ï¼ˆæ¥æ”¶è®¢å•é€šçŸ¥ï¼‰
wrangler secret put NOTIFY_EMAIL
# è¾“å…¥ï¼šadmin@yourstore.com
```

#### Secrets è¯´æ˜

| å˜é‡å | å¿…å¡« | è¯´æ˜ | è·å–æ–¹å¼ |
|--------|------|------|----------|
| `SUPABASE_URL` | âœ… | Supabase é¡¹ç›® URL | Supabase Dashboard > Settings > API > Project URL |
| `SUPABASE_SERVICE_KEY` | âœ… | Supabase æœåŠ¡ç«¯å¯†é’¥ | Supabase Dashboard > Settings > API > service_role secret |
| `STRIPE_SECRET_KEY` | âœ… | Stripe å¯†é’¥ | Stripe Dashboard > Developers > API keys > Secret key |
| `STRIPE_WEBHOOK_SECRET` | âœ… | Stripe Webhook ç­¾åå¯†é’¥ | Stripe Dashboard > Developers > Webhooksï¼ˆåˆ›å»ºç«¯ç‚¹åè·å–ï¼‰|
| `DEEPSEEK_API_KEY` | â¬œ | DeepSeek AI å¯†é’¥ | DeepSeek å®˜ç½‘ > API Keys |
| `RESEND_API_KEY` | âœ… | Resend é‚®ä»¶å¯†é’¥ | Resend Dashboard > API Keys |
| `NOTIFY_EMAIL` | âœ… | é€šçŸ¥é‚®ç®± | æ‚¨çš„ç®¡ç†å‘˜é‚®ç®± |

#### wrangler.toml é…ç½®

```toml
name = "b2c-ai-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# éæ•æ„Ÿç¯å¢ƒå˜é‡
[vars]
DEFAULT_BRAND_SLUG = "default-brand"  # å¼€å‘ç¯å¢ƒé»˜è®¤å“ç‰Œ
ENVIRONMENT = "production"

# KV ç¼“å­˜ï¼ˆå¯é€‰ï¼Œç”¨äºå“ç‰Œé…ç½®ç¼“å­˜ï¼‰
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"
preview_id = "your-preview-kv-namespace-id"
```

---

## æ•°æ®åº“éƒ¨ç½²

### 1. åˆ›å»º Supabase é¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com)
2. åˆ›å»ºæ–°é¡¹ç›®
3. è®°å½•é¡¹ç›® URL å’Œ API Keys

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»

æŒ‰é¡ºåºåœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­æ‰§è¡Œä»¥ä¸‹æ–‡ä»¶ï¼š

```
docs/database/001_initial_schema.sql      # åŸºç¡€è¡¨ç»“æ„
docs/database/002_rls_policies.sql        # è¡Œçº§å®‰å…¨ç­–ç•¥
docs/database/003_sample_data.sql         # ç¤ºä¾‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
docs/database/004_pgvector_ai.sql         # AI å‘é‡æ”¯æŒ
docs/database/005_content_quality.sql     # å†…å®¹è´¨é‡æ§åˆ¶
docs/database/005_orders_payment.sql      # è®¢å•å’Œæ”¯ä»˜
docs/database/006_reviews.sql             # è¯„ä»·ç³»ç»Ÿ
docs/database/007_coupons.sql             # ä¼˜æƒ åˆ¸ç³»ç»Ÿ
docs/database/008_admin_users.sql         # ç®¡ç†å‘˜ç”¨æˆ·
docs/database/009_blog_support.sql        # åšå®¢ç³»ç»Ÿ
```

### 3. å¯ç”¨ pgvector æ‰©å±•

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

### 4. åˆ›å»ºåˆå§‹å“ç‰Œ

```sql
INSERT INTO brands (name, slug, domain, owner_email, is_active)
VALUES ('My Store', 'mystore', 'yourstore.com', 'admin@yourstore.com', true);
```

### 5. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·

```sql
-- å…ˆé€šè¿‡ Supabase Auth æ³¨å†Œç”¨æˆ·ï¼Œç„¶åæ‰§è¡Œï¼š
INSERT INTO admin_users (auth_user_id, email, name, role)
VALUES ('your-auth-user-id', 'admin@yourstore.com', 'Admin', 'super_admin');
```

---

## åç«¯éƒ¨ç½²

### 1. å®‰è£… Wrangler CLI

```bash
npm install -g wrangler
wrangler login
```

### 2. é…ç½® Secrets

å‚è€ƒä¸Šé¢çš„ [åç«¯ç¯å¢ƒå˜é‡](#åç«¯ç¯å¢ƒå˜é‡-secrets) éƒ¨åˆ†ã€‚

### 3. åˆ›å»º KV ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

```bash
# åˆ›å»º KV namespace
wrangler kv:namespace create "CACHE"

# å°†è¿”å›çš„ id æ·»åŠ åˆ° wrangler.toml
# [[kv_namespaces]]
# binding = "CACHE"
# id = "è¿”å›çš„-id"
```

### 4. éƒ¨ç½²åˆ° Cloudflare Workers

```bash
cd worker

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
wrangler deploy

# æˆ–éƒ¨ç½²åˆ°ç‰¹å®šç¯å¢ƒ
wrangler deploy --env production
```

### 5. é…ç½®è‡ªå®šä¹‰åŸŸå

1. åœ¨ Cloudflare Dashboard ä¸­æ·»åŠ åŸŸå
2. Workers > ä½ çš„ Worker > Triggers > Custom Domains
3. æ·»åŠ è‡ªå®šä¹‰åŸŸåï¼ˆå¦‚ `api.yourstore.com`ï¼‰

---

## å‰ç«¯éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šCloudflare Pagesï¼ˆæ¨èï¼‰

#### 1. è¿æ¥ Git ä»“åº“

1. ç™»å½• Cloudflare Dashboard
2. Pages > Create a project > Connect to Git
3. é€‰æ‹©ä»“åº“å’Œåˆ†æ”¯ï¼ˆå¦‚ `main`ï¼‰

#### 2. æ„å»ºé…ç½®

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| Framework preset | Astro |
| Build command | `npm run build` |
| Build output directory | `dist` |
| Root directory | `frontend` |

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ Pages > Settings > Environment variables ä¸­æ·»åŠ ï¼š

```
PUBLIC_SUPABASE_URL = https://xxx.supabase.co
PUBLIC_SUPABASE_ANON_KEY = eyJhbG...
PUBLIC_API_URL = https://api.yourstore.com
PUBLIC_SITE_URL = https://yourstore.com
PUBLIC_SITE_NAME = My Store
PUBLIC_STRIPE_PUBLISHABLE_KEY = pk_live_...
```

#### 4. é…ç½®è‡ªå®šä¹‰åŸŸå

1. Pages > ä½ çš„é¡¹ç›® > Custom domains
2. æ·»åŠ åŸŸåï¼ˆå¦‚ `yourstore.com`ï¼‰
3. é…ç½® DNS è®°å½•

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
cd frontend
npm run build
# å°† dist/ ç›®å½•éƒ¨ç½²åˆ°ä»»ä½•é™æ€æ‰˜ç®¡æœåŠ¡
```

---

## ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®

### Stripe é…ç½®

#### 1. åˆ›å»º Webhook

1. ç™»å½• [Stripe Dashboard](https://dashboard.stripe.com)
2. Developers > Webhooks > Add endpoint
3. ç«¯ç‚¹ URLï¼š`https://api.yourstore.com/api/stripe/webhook`
4. é€‰æ‹©äº‹ä»¶ï¼š
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
   - `charge.refunded`
5. å¤åˆ¶ Signing secret åˆ° `STRIPE_WEBHOOK_SECRET`

#### 2. é…ç½®æ”¯ä»˜æ–¹å¼

åœ¨ Stripe Dashboard å¯ç”¨ï¼š
- Cardsï¼ˆä¿¡ç”¨å¡/å€Ÿè®°å¡ï¼‰
- Apple Pay
- Google Pay

#### 3. æµ‹è¯•æ¨¡å¼ vs ç”Ÿäº§æ¨¡å¼

- **æµ‹è¯•æ¨¡å¼**: ä½¿ç”¨ `pk_test_` å’Œ `sk_test_` å¼€å¤´çš„å¯†é’¥
- **ç”Ÿäº§æ¨¡å¼**: ä½¿ç”¨ `pk_live_` å’Œ `sk_live_` å¼€å¤´çš„å¯†é’¥

### Resend é‚®ä»¶é…ç½®

#### 1. éªŒè¯å‘ä»¶åŸŸå

1. ç™»å½• [Resend Dashboard](https://resend.com)
2. Domains > Add Domain
3. æ·»åŠ æ‚¨çš„åŸŸåï¼ˆå¦‚ `yourstore.com`ï¼‰
4. é…ç½® DNS è®°å½•ï¼ˆSPFã€DKIMï¼‰

#### 2. åˆ›å»º API Key

1. API Keys > Create API Key
2. é€‰æ‹©æƒé™ï¼šSend emails
3. å¤åˆ¶å¯†é’¥åˆ° `RESEND_API_KEY`

### DeepSeek AI é…ç½®ï¼ˆå¯é€‰ï¼‰

#### 1. è·å– API Key

1. è®¿é—® [DeepSeek å®˜ç½‘](https://www.deepseek.com)
2. æ³¨å†Œå¹¶åˆ›å»º API Key
3. å¤åˆ¶å¯†é’¥åˆ° `DEEPSEEK_API_KEY`

#### 2. å¯ç”¨ AI å®¢æœ

åœ¨æ•°æ®åº“ä¸­ä¸ºå“ç‰Œé…ç½® AI è®¾ç½®ï¼š

```sql
INSERT INTO settings (brand_id, key, value) VALUES
('your-brand-uuid', 'ai_enabled', 'true'),
('your-brand-uuid', 'ai_system_prompt', '"ä½ æ˜¯ {brand_name} çš„å®¢æœåŠ©æ‰‹..."'),
('your-brand-uuid', 'ai_welcome_message', '"æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ"'),
('your-brand-uuid', 'ai_max_context_messages', '10'),
('your-brand-uuid', 'ai_handoff_keywords', '["æŠ•è¯‰", "é€€æ¬¾", "äººå·¥"]');
```

---

## å¤šå“ç‰Œé…ç½®

### 1. DNS é…ç½®

ä¸ºæ¯ä¸ªå“ç‰Œé…ç½® DNS è®°å½•ï¼š

```
# å“ç‰Œ 1
brand1.com      A/CNAME  -> Cloudflare Pages
api.brand1.com  CNAME    -> your-worker.workers.dev

# å“ç‰Œ 2
brand2.com      A/CNAME  -> Cloudflare Pages
api.brand2.com  CNAME    -> your-worker.workers.dev
```

### 2. æ•°æ®åº“é…ç½®

åœ¨ `brands` è¡¨ä¸­æ·»åŠ å“ç‰Œï¼š

```sql
INSERT INTO brands (name, slug, domain, owner_email, is_active)
VALUES 
  ('Brand One', 'brand1', 'brand1.com', 'owner@brand1.com', true),
  ('Brand Two', 'brand2', 'brand2.com', 'owner@brand2.com', true);
```

### 3. å“ç‰Œéš”ç¦»

ç³»ç»Ÿé€šè¿‡åŸŸåè‡ªåŠ¨è¯†åˆ«å“ç‰Œï¼š
- æ‰€æœ‰æ•°æ®æŒ‰ `brand_id` éš”ç¦»
- æ¯ä¸ªå“ç‰Œç‹¬ç«‹çš„äº§å“ã€è®¢å•ã€å®¢æˆ·æ•°æ®
- ç‹¬ç«‹çš„ AI é…ç½®å’ŒçŸ¥è¯†åº“

---

## æœ¬åœ°å¼€å‘

### å¯åŠ¨åç«¯

```bash
cd worker
npm install
npm run dev  # å¯åŠ¨åœ¨ http://localhost:8787
```

### å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm install
npm run dev  # å¯åŠ¨åœ¨ http://localhost:4321
```

### æœ¬åœ°ç¯å¢ƒå˜é‡

#### å‰ç«¯ (frontend/.env.local)

```env
PUBLIC_SUPABASE_URL=https://xxx.supabase.co
PUBLIC_SUPABASE_ANON_KEY=eyJhbG...
PUBLIC_API_URL=http://localhost:8787
PUBLIC_SITE_URL=http://localhost:4321
PUBLIC_SITE_NAME=Dev Store
PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
```

#### åç«¯ (worker/.dev.vars)

```env
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbG...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
DEEPSEEK_API_KEY=sk-...
RESEND_API_KEY=re_...
NOTIFY_EMAIL=admin@yourstore.com
DEFAULT_BRAND_SLUG=default-brand
ENVIRONMENT=development
```

### éªŒè¯é…ç½®

```bash
# æµ‹è¯•åç«¯
curl http://localhost:8787/api/health
# åº”è¿”å›ï¼š{"status": "ok", "environment": "development"}

# æµ‹è¯•å‰ç«¯
# è®¿é—® http://localhost:4321ï¼Œæ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½
```

---

## ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

### å®‰å…¨æ£€æŸ¥

- [ ] æ‰€æœ‰å¯†é’¥ä½¿ç”¨ Wrangler secretsï¼Œä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
- [ ] Supabase RLS ç­–ç•¥å·²å¯ç”¨
- [ ] CORS é…ç½®é™åˆ¶ä¸ºå…è®¸çš„åŸŸå
- [ ] Stripe Webhook ç­¾åéªŒè¯å·²å¯ç”¨
- [ ] HTTPS å·²å¯ç”¨ï¼ˆCloudflare è‡ªåŠ¨æä¾›ï¼‰
- [ ] ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `pk_live_` å’Œ `sk_live_` å¯†é’¥

### æ€§èƒ½æ£€æŸ¥

- [ ] KV ç¼“å­˜å·²é…ç½®ï¼ˆå“ç‰Œä¿¡æ¯ã€çƒ­é—¨äº§å“ï¼‰
- [ ] å›¾ç‰‡ä½¿ç”¨ CDNï¼ˆCloudflare Images æˆ–å…¶ä»–ï¼‰
- [ ] é™æ€èµ„æºå¯ç”¨ç¼“å­˜å¤´
- [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] pgvector ç´¢å¼•å·²ä¼˜åŒ–

### ç›‘æ§æ£€æŸ¥

- [ ] Cloudflare Analytics å·²å¯ç”¨
- [ ] Worker é”™è¯¯æ—¥å¿—å·²é…ç½®
- [ ] Stripe Dashboard ç›‘æ§å·²è®¾ç½®
- [ ] Supabase ç›‘æ§å·²å¯ç”¨

### é‚®ä»¶æ£€æŸ¥

- [ ] Resend å‘ä»¶åŸŸåå·²éªŒè¯
- [ ] SPF/DKIM è®°å½•å·²é…ç½®
- [ ] é‚®ä»¶æ¨¡æ¿å·²æµ‹è¯•
- [ ] è®¢å•ç¡®è®¤é‚®ä»¶æ­£å¸¸å‘é€

### SEO æ£€æŸ¥

- [ ] sitemap.xml å¯è®¿é—®ï¼ˆ`/sitemap.xml`ï¼‰
- [ ] robots.txt å·²é…ç½®ï¼ˆ`/robots.txt`ï¼‰
- [ ] Google Search Console å·²éªŒè¯
- [ ] æ‰€æœ‰é¡µé¢æœ‰æ­£ç¡®çš„ meta æ ‡ç­¾
- [ ] Schema.org ç»“æ„åŒ–æ•°æ®å·²æ·»åŠ 

### åŠŸèƒ½æ£€æŸ¥

- [ ] äº§å“æµè§ˆæ­£å¸¸
- [ ] è´­ç‰©è½¦åŠŸèƒ½æ­£å¸¸
- [ ] æ”¯ä»˜æµç¨‹å®Œæ•´
- [ ] è®¢å•ç¡®è®¤é‚®ä»¶å‘é€
- [ ] AI å®¢æœæ­£å¸¸å·¥ä½œï¼ˆå¦‚å¯ç”¨ï¼‰
- [ ] ç®¡ç†åå°å¯è®¿é—®
- [ ] å¤šå“ç‰ŒåŸŸåè¯†åˆ«æ­£å¸¸

---

## æ•…éšœæ’é™¤

### Worker è¿”å› 500 é”™è¯¯

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. æŸ¥çœ‹ Cloudflare Dashboard > Workers > Logs
2. æ£€æŸ¥æ‰€æœ‰ Secrets æ˜¯å¦å·²é…ç½®
3. éªŒè¯ Supabase è¿æ¥
4. æ£€æŸ¥ä»£ç è¯­æ³•é”™è¯¯

**å¸¸è§åŸå› ï¼š**
- ç¯å¢ƒå˜é‡æœªé…ç½®æˆ–é…ç½®é”™è¯¯
- Supabase è¿æ¥å¤±è´¥
- Stripe API è°ƒç”¨å¤±è´¥

### è·¨åŸŸè¯·æ±‚å¤±è´¥ (CORS)

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. ç¡®è®¤ Worker çš„ CORS é…ç½®
2. æ£€æŸ¥å‰ç«¯åŸŸåæ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ä¸­
3. éªŒè¯ `PUBLIC_API_URL` é…ç½®æ­£ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// worker/src/utils/response.ts
export function cors() {
  return new Response(null, {
    headers: {
      'Access-Control-Allow-Origin': 'https://yourstore.com',
      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type',
    },
  });
}
```

### Stripe Webhook éªŒè¯å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. ç¡®è®¤ `STRIPE_WEBHOOK_SECRET` æ­£ç¡®é…ç½®
2. éªŒè¯ Webhook URL å®Œå…¨åŒ¹é…
3. æ£€æŸ¥ Stripe Dashboard ä¸­çš„ Webhook çŠ¶æ€

**æµ‹è¯•æ–¹æ³•ï¼š**
```bash
# ä½¿ç”¨ Stripe CLI æµ‹è¯•
stripe listen --forward-to http://localhost:8787/api/stripe/webhook
stripe trigger payment_intent.succeeded
```

### é‚®ä»¶å‘é€å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. éªŒè¯ Resend API Key æ­£ç¡®
2. æ£€æŸ¥å‘ä»¶åŸŸåéªŒè¯çŠ¶æ€
3. æŸ¥çœ‹ Resend Dashboard ä¸­çš„æ—¥å¿—

**å¸¸è§åŸå› ï¼š**
- API Key æ— æ•ˆæˆ–è¿‡æœŸ
- åŸŸåæœªéªŒè¯
- SPF/DKIM è®°å½•æœªé…ç½®

### AI å®¢æœä¸å·¥ä½œ

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. éªŒè¯ `DEEPSEEK_API_KEY` å·²é…ç½®
2. æ£€æŸ¥å“ç‰Œçš„ `ai_enabled` è®¾ç½®ä¸º `true`
3. éªŒè¯çŸ¥è¯†åº“æœ‰å†…å®¹
4. æŸ¥çœ‹ Worker æ—¥å¿—ä¸­çš„ AI API é”™è¯¯

**æµ‹è¯•æ–¹æ³•ï¼š**
```bash
# æµ‹è¯• AI å¯¹è¯
curl -X POST http://localhost:8787/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½", "sessionId": "test-123"}'
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. éªŒè¯ `SUPABASE_URL` å’Œ `SUPABASE_SERVICE_KEY`
2. æ£€æŸ¥ Supabase é¡¹ç›®çŠ¶æ€
3. éªŒè¯ RLS ç­–ç•¥é…ç½®

**æµ‹è¯•æ–¹æ³•ï¼š**
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
curl https://your-project.supabase.co/rest/v1/brands \
  -H "apikey: your-service-key" \
  -H "Authorization: Bearer your-service-key"
```

---

## å®‰å…¨æœ€ä½³å®è·µ

### âš ï¸ åˆ‡å‹¿æ³„éœ²çš„å¯†é’¥

- `SUPABASE_SERVICE_KEY` - æ‹¥æœ‰å®Œå…¨æ•°æ®åº“æƒé™
- `STRIPE_SECRET_KEY` - å¯ä»¥åˆ›å»ºæ”¯ä»˜ã€é€€æ¬¾
- `STRIPE_WEBHOOK_SECRET` - ç”¨äºéªŒè¯ Webhook çœŸå®æ€§
- `DEEPSEEK_API_KEY` - ä¼šäº§ç”Ÿ API è´¹ç”¨
- `RESEND_API_KEY` - å¯ä»¥å‘é€é‚®ä»¶

### âœ… å¯ä»¥å…¬å¼€çš„å¯†é’¥

- `PUBLIC_SUPABASE_URL` - å…¬å¼€çš„é¡¹ç›® URL
- `PUBLIC_SUPABASE_ANON_KEY` - å— RLS ç­–ç•¥ä¿æŠ¤
- `PUBLIC_STRIPE_PUBLISHABLE_KEY` - ä»…ç”¨äºå‰ç«¯åˆ›å»ºæ”¯ä»˜è¡¨å•

### ğŸ”’ å®‰å…¨å»ºè®®

1. **ä½¿ç”¨ `.gitignore`** - å¿½ç•¥æ‰€æœ‰ `.env` å’Œ `.dev.vars` æ–‡ä»¶
2. **ä½¿ç”¨ Secrets ç®¡ç†** - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Cloudflare Secrets
3. **å®šæœŸè½®æ¢å¯†é’¥** - æ¯ 3-6 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ API å¯†é’¥
4. **ç¯å¢ƒéš”ç¦»** - æµ‹è¯•å’Œç”Ÿäº§ä½¿ç”¨ä¸åŒçš„å¯†é’¥
5. **ä»£ç å®¡æŸ¥** - ç¡®ä¿æ²¡æœ‰ç¡¬ç¼–ç çš„å¯†é’¥
6. **æœ€å°æƒé™åŸåˆ™** - åªæˆäºˆå¿…è¦çš„æƒé™

---

## å¸¸ç”¨å‘½ä»¤

### Wrangler å‘½ä»¤

```bash
# æŸ¥çœ‹å·²é…ç½®çš„ Secrets
wrangler secret list

# åˆ é™¤ Secret
wrangler secret delete SECRET_NAME

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
wrangler deploy

# æŸ¥çœ‹æ—¥å¿—
wrangler tail

# åˆ›å»º KV namespace
wrangler kv:namespace create "CACHE"
```

### æ•°æ®åº“å‘½ä»¤

```bash
# è¿æ¥åˆ° Supabase
psql "postgresql://postgres:[password]@db.[project].supabase.co:5432/postgres"

# å¤‡ä»½æ•°æ®åº“
pg_dump -h db.[project].supabase.co -U postgres -d postgres > backup.sql

# æ¢å¤æ•°æ®åº“
psql -h db.[project].supabase.co -U postgres -d postgres < backup.sql
```

---

## æ›´æ–°æ—¥å¿—

- **2025-12-25**: åˆå§‹ç‰ˆæœ¬ï¼Œæ•´åˆéƒ¨ç½²å’Œé…ç½®æ–‡æ¡£
- **2025-12-25**: æ·»åŠ  AI å®¢æœé…ç½®è¯´æ˜
- **2025-12-25**: æ·»åŠ å¤šå“ç‰Œé…ç½®æŒ‡å—

---

## ç›¸å…³æ–‡æ¡£

- [AI å®¢æœç³»ç»Ÿå®ç°è¯´æ˜](./AIå®¢æœç³»ç»Ÿå®ç°è¯´æ˜.md)
- [åšå®¢ç³»ç»Ÿå®ç°æŒ‡å—](./åšå®¢ç³»ç»Ÿå®ç°æŒ‡å—.md)
- [å¼€å‘è®¡åˆ’](./å¼€å‘è®¡åˆ’.md)
- [åŠŸèƒ½è¯´æ˜](./åŠŸèƒ½è¯´æ˜.md)
- [å®‰å…¨æ€§è¯´æ˜](./å®‰å…¨æ€§è¯´æ˜.md)