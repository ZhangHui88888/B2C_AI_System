# 3.3 订单和支付

## 功能概述

实现订单创建、Stripe支付集成和邮件通知系统。

## API端点

### 订单API ([`orders.ts`](../../worker/src/routes/orders.ts))

**POST /api/orders/create** - 创建订单
- 验证购物车
- 计算金额
- 创建Stripe PaymentIntent
- 返回client_secret

**GET /api/orders/:id** - 订单详情
- 验证订单归属
- 返回完整信息

**POST /api/stripe/webhook** - Stripe Webhook
- 验证签名
- 处理支付成功/失败
- 更新订单状态
- 发送邮件通知

## 支付流程

1. 前端创建订单
2. 获取clientSecret
3. Stripe Elements收集支付信息
4. 确认支付
5. Webhook更新订单
6. 发送确认邮件

## 邮件通知

使用Resend API发送：
- 订单确认邮件
- 发货通知邮件

## 状态

✅ **已完成** - 订单和支付功能已实现