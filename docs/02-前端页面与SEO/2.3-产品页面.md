# 2.3 产品页面

## 功能概述

实现产品浏览、筛选、详情展示等核心电商功能。

## 页面结构

### 产品列表页 ([`/products/index.astro`](../../frontend/src/pages/products/index.astro))

**布局**:
```
┌─────────────┬──────────────────────┐
│             │  排序: [下拉选择]    │
│  筛选栏     ├──────────────────────┤
│             │  ┌────┐ ┌────┐ ┌────┐│
│  分类       │  │产品│ │产品│ │产品││
│  价格区间   │  └────┘ └────┘ └────┘│
│  品牌       │  ┌────┐ ┌────┐ ┌────┐│
│  评分       │  │产品│ │产品│ │产品││
│             │  └────┘ └────┘ └────┘│
│             │  [分页组件]          │
└─────────────┴──────────────────────┘
```

**功能**:
1. **筛选栏**
   - 分类筛选（多选）
   - 价格区间滑块
   - 品牌筛选（可选）
   - 评分筛选
   - 清除筛选按钮

2. **排序选项**
   - 价格：低到高
   - 价格：高到低
   - 最新上架
   - 最畅销
   - 评分最高

3. **产品网格**
   - 响应式布局（1/2/3/4列）
   - 使用ProductCard组件
   - 加载状态显示

4. **分页**
   - 页码导航
   - 上一页/下一页
   - 跳转到指定页

**URL参数**:
```
/products?category=electronics&price_min=100&price_max=500&sort=price_asc&page=2
```

### 产品详情页 ([`/products/[slug].astro`](../../frontend/src/pages/products/[slug].astro))

**布局**:
```
┌──────────────┬──────────────────────┐
│              │  产品名称            │
│  图片画廊    │  ★★★★☆ (128评价)   │
│              │  $99.99 ~~$129.99~~  │
│  [主图]      │                      │
│              │  [数量选择器]        │
│  [缩略图]    │  [加入购物车]        │
│              │  [立即购买]          │
└──────────────┴──────────────────────┘
│  [产品描述] [规格参数] [发货说明]  │
├─────────────────────────────────────┤
│  客户评价 (128)                     │
│  ★★★★★ 很好用！                   │
├─────────────────────────────────────┤
│  相关产品推荐                       │
│  [产品1] [产品2] [产品3] [产品4]   │
└─────────────────────────────────────┘
```

**核心功能**:

1. **图片画廊** ([`ImageGallery.astro`](../../frontend/src/components/catalog/ImageGallery.astro))
   - 主图显示
   - 缩略图切换
   - 点击放大
   - 左右滑动（移动端）

2. **产品信息**
   - 产品名称（H1标签）
   - 评分和评价数
   - 价格显示（原价/促销价）
   - 库存状态
   - SKU信息

3. **购买操作**
   - 数量选择器（+/-按钮）
   - 加入购物车按钮
   - 立即购买按钮
   - 收藏按钮（可选）

4. **产品Tab**
   - 产品描述（富文本）
   - 规格参数（表格）
   - 发货说明
   - 退换货政策

5. **评价区域** ([`ProductReviews.astro`](../../frontend/src/components/product/ProductReviews.astro))
   - 评分统计
   - 评价列表
   - 筛选（全部/好评/中评/差评）
   - 分页加载

6. **相关产品**
   - 同分类产品
   - 价格相近产品
   - 限制4-6个
   - 使用ProductCard组件

**SEO优化**:
- 集成ProductSchema
- 面包屑导航
- 语义化HTML
- 图片alt属性

### 分类页面 ([`/category/[slug].astro`](../../frontend/src/pages/category/[slug].astro))

**功能**:
- 复用产品列表组件
- 显示分类描述
- 子分类导航
- 分类特色图片

**面包屑**:
```
首页 > 电子产品 > 手机配件
```

## 核心组件

### ImageGallery ([`ImageGallery.astro`](../../frontend/src/components/catalog/ImageGallery.astro))

**功能**:
- 主图展示
- 缩略图列表
- 点击切换
- 放大查看
- 移动端滑动

**交互**:
```javascript
// 图片切换
function selectImage(index) {
  currentImage = images[index];
}

// 放大查看
function zoomImage() {
  // 打开Lightbox
}
```

### AddToCartForm ([`AddToCartForm.astro`](../../frontend/src/components/catalog/AddToCartForm.astro))

**功能**:
- 数量选择
- 规格选择（如有）
- 库存验证
- 加购动画
- 错误提示

**验证逻辑**:
```javascript
// 库存检查
if (quantity > stock) {
  showError('库存不足');
  return;
}

// 加入购物车
addToCart({
  productId,
  quantity,
  variant
});
```

### Pagination ([`Pagination.astro`](../../frontend/src/components/catalog/Pagination.astro))

**功能**:
- 页码列表
- 上一页/下一页
- 首页/尾页
- 当前页高亮
- 省略号（...）

**URL更新**:
```javascript
// 保持其他参数
function goToPage(page) {
  const url = new URL(window.location);
  url.searchParams.set('page', page);
  window.location.href = url.toString();
}
```

## 筛选和排序

### 筛选逻辑

**前端**:
- 构建筛选URL参数
- 更新页面状态
- 显示已选筛选项

**后端API**:
```typescript
// POST /api/products/list
{
  category_id?: string;
  price_min?: number;
  price_max?: number;
  brand_ids?: string[];
  rating_min?: number;
  sort?: 'price_asc' | 'price_desc' | 'newest' | 'bestseller';
  page: number;
  pageSize: number;
}
```

### 排序选项

| 选项 | 说明 | SQL |
|------|------|-----|
| price_asc | 价格低到高 | ORDER BY price ASC |
| price_desc | 价格高到低 | ORDER BY price DESC |
| newest | 最新上架 | ORDER BY created_at DESC |
| bestseller | 最畅销 | ORDER BY sales_count DESC |
| rating | 评分最高 | ORDER BY rating DESC |

## 相关产品算法

**逻辑**:
1. 同分类产品
2. 价格相近（±30%）
3. 排除当前产品
4. 限制6个
5. 随机排序

**SQL示例**:
```sql
SELECT * FROM products
WHERE category_id = $1
  AND id != $2
  AND price BETWEEN $3 * 0.7 AND $3 * 1.3
  AND is_active = true
ORDER BY RANDOM()
LIMIT 6;
```

## 性能优化

### 查询优化
- 添加复合索引：`(brand_id, category_id, price)`
- 使用`COUNT(*) OVER()`获取总数
- 限制返回字段
- 批量查询相关数据

### 图片优化
- 主图优先加载
- 缩略图懒加载
- 使用WebP格式
- CDN加速
- 响应式图片（srcset）

### 缓存策略
- 产品列表缓存5分钟
- 产品详情缓存10分钟
- 分类数据缓存1小时
- 使用Cloudflare Cache API

## 移动端优化

### 响应式布局
- 产品网格：1列（手机）→ 2列（平板）→ 4列（桌面）
- 筛选栏：抽屉式侧边栏
- 图片画廊：滑动切换

### 触摸优化
- 按钮尺寸≥44px
- 滑动手势支持
- 减少动画效果

## 相关文档

- [产品API](../03-后端API/3.2-基础API.md)
- [购物车功能](./2.4-购物车和结算.md)
- [评价系统](../04-管理后台/4.5-内容管理.md)

## 状态

✅ **已完成** - 所有产品页面已实现