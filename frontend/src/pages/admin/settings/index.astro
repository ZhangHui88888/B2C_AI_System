---
import AdminLayout from '@layouts/AdminLayout.astro';
import { supabase } from '@lib/supabase';

// Get current settings
const { data: settings } = await supabase
  .from('settings')
  .select('key, value');

const settingsMap = new Map<string, any>();
settings?.forEach((s) => settingsMap.set(s.key, s.value));

const aiEnabled = settingsMap.get('ai_enabled') === true || settingsMap.get('ai_enabled') === 'true';
const aiSystemPrompt = settingsMap.get('ai_system_prompt') || '';
const aiWelcomeMessage = settingsMap.get('ai_welcome_message') || 'Hello! How can I help you today?';
const aiHandoffKeywords = settingsMap.get('ai_handoff_keywords') || ['complaint', 'refund', 'human'];
const storeName = settingsMap.get('store_name') || '';
const notifyEmail = settingsMap.get('notify_email') || '';

// Payment settings
const currency = settingsMap.get('currency') || 'usd';
const stripePublicKey = settingsMap.get('stripe_public_key') || '';
const paymentMethods = settingsMap.get('payment_methods') || ['card'];

// Shipping settings
const shippingDefaultCost = settingsMap.get('shipping_default_cost') ?? 5.99;
const shippingFreeThreshold = settingsMap.get('shipping_free_threshold') ?? 50;
const shippingEstimate = settingsMap.get('shipping_estimate') || '3-7 business days';
const shippingCountries = settingsMap.get('shipping_countries') || ['US', 'CA', 'GB', 'AU'];

const currencyOptions = [
  { value: 'usd', label: 'USD ($)' },
  { value: 'eur', label: 'EUR (€)' },
  { value: 'gbp', label: 'GBP (£)' },
  { value: 'cad', label: 'CAD ($)' },
  { value: 'aud', label: 'AUD ($)' },
  { value: 'jpy', label: 'JPY (¥)' },
  { value: 'cny', label: 'CNY (¥)' },
];

const countryOptions = [
  { value: 'US', label: 'United States' },
  { value: 'CA', label: 'Canada' },
  { value: 'GB', label: 'United Kingdom' },
  { value: 'AU', label: 'Australia' },
  { value: 'DE', label: 'Germany' },
  { value: 'FR', label: 'France' },
  { value: 'JP', label: 'Japan' },
  { value: 'CN', label: 'China' },
  { value: 'SG', label: 'Singapore' },
  { value: 'NZ', label: 'New Zealand' },
];
---

<AdminLayout title="Settings" activePage="settings">
  <div class="max-w-3xl space-y-6">
    <!-- Store Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Store Settings</h2>
      
      <form id="store-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Store Name</label>
          <input type="text" name="store_name" value={storeName} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Your Store Name" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Notification Email</label>
          <input type="email" name="notify_email" value={notifyEmail} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="orders@yourstore.com" />
          <p class="text-xs text-gray-500 mt-1">Receive order notifications at this email</p>
        </div>

        <button type="submit" class="px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors">
          Save Store Settings
        </button>
      </form>
    </div>

    <!-- Payment Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Payment Settings</h2>
      
      <form id="payment-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
            <select name="currency" class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500">
              {currencyOptions.map((opt) => (
                <option value={opt.value} selected={currency === opt.value}>{opt.label}</option>
              ))}
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Stripe Public Key</label>
            <input type="text" name="stripe_public_key" value={stripePublicKey} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500 font-mono text-sm" placeholder="pk_live_..." />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Payment Methods</label>
          <div class="flex flex-wrap gap-4">
            <label class="flex items-center">
              <input type="checkbox" name="payment_methods" value="card" checked={paymentMethods.includes('card')} class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" />
              <span class="ml-2 text-sm text-gray-700">Credit/Debit Card</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="payment_methods" value="apple_pay" checked={paymentMethods.includes('apple_pay')} class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" />
              <span class="ml-2 text-sm text-gray-700">Apple Pay</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="payment_methods" value="google_pay" checked={paymentMethods.includes('google_pay')} class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" />
              <span class="ml-2 text-sm text-gray-700">Google Pay</span>
            </label>
          </div>
          <p class="text-xs text-gray-500 mt-2">Stripe automatically handles supported payment methods</p>
        </div>

        <button type="submit" class="px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors">
          Save Payment Settings
        </button>
      </form>
    </div>

    <!-- Shipping Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Shipping Settings</h2>
      
      <form id="shipping-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Default Shipping Cost</label>
            <div class="relative">
              <span class="absolute left-3 top-2 text-gray-500">$</span>
              <input type="number" name="shipping_default_cost" value={shippingDefaultCost} min="0" step="0.01" class="w-full pl-7 border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" />
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Free Shipping Threshold</label>
            <div class="relative">
              <span class="absolute left-3 top-2 text-gray-500">$</span>
              <input type="number" name="shipping_free_threshold" value={shippingFreeThreshold} min="0" step="0.01" class="w-full pl-7 border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" />
            </div>
            <p class="text-xs text-gray-500 mt-1">Free shipping for orders above this amount (0 = no free shipping)</p>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Estimated Delivery Time</label>
          <input type="text" name="shipping_estimate" value={shippingEstimate} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="3-7 business days" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Shipping Countries</label>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
            {countryOptions.map((country) => (
              <label class="flex items-center">
                <input type="checkbox" name="shipping_countries" value={country.value} checked={shippingCountries.includes(country.value)} class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded" />
                <span class="ml-2 text-sm text-gray-700">{country.label}</span>
              </label>
            ))}
          </div>
        </div>

        <button type="submit" class="px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors">
          Save Shipping Settings
        </button>
      </form>
    </div>

    <!-- AI Settings -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">AI Customer Service</h2>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" id="ai-toggle" class="sr-only peer" checked={aiEnabled} />
          <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
          <span class="ml-2 text-sm font-medium text-gray-700">Enabled</span>
        </label>
      </div>
      
      <form id="ai-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Welcome Message</label>
          <input type="text" name="ai_welcome_message" value={aiWelcomeMessage} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">System Prompt</label>
          <textarea name="ai_system_prompt" rows="4" class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" placeholder="Custom instructions for the AI assistant...">{aiSystemPrompt}</textarea>
          <p class="text-xs text-gray-500 mt-1">Use {'{brand_name}'} as a placeholder for your store name</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Human Handoff Keywords</label>
          <input type="text" name="ai_handoff_keywords" value={aiHandoffKeywords.join(', ')} class="w-full border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500" />
          <p class="text-xs text-gray-500 mt-1">Comma-separated keywords that trigger human support flag</p>
        </div>

        <button type="submit" class="px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors">
          Save AI Settings
        </button>
      </form>
    </div>

    <!-- Email Templates -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Email Templates</h2>
      <p class="text-sm text-gray-600 mb-4">Customize the emails sent to customers. Use variables like <code class="bg-gray-100 px-1 rounded">{`{{customer_name}}`}</code>, <code class="bg-gray-100 px-1 rounded">{`{{order_id}}`}</code>, <code class="bg-gray-100 px-1 rounded">{`{{order_total}}`}</code>.</p>
      
      <div class="space-y-4">
        <!-- Order Confirmation -->
        <div class="border border-gray-200 rounded-lg">
          <button type="button" class="template-toggle w-full flex items-center justify-between p-4 text-left" data-template="order_confirmation">
            <div>
              <span class="font-medium text-gray-900">Order Confirmation</span>
              <p class="text-sm text-gray-500">Sent when an order is placed</p>
            </div>
            <svg class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="template-content hidden p-4 border-t border-gray-200 bg-gray-50">
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                <input type="text" name="email_order_confirmation_subject" class="w-full border-gray-300 rounded-lg text-sm" value="Your order #{{order_id}} has been confirmed!" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Body</label>
                <textarea name="email_order_confirmation_body" rows="6" class="w-full border-gray-300 rounded-lg text-sm font-mono">Hi {{customer_name}},

Thank you for your order! We've received your order #{{order_id}} and are preparing it for shipment.

Order Total: {{order_total}}

We'll send you another email when your order ships.

Thanks for shopping with us!</textarea>
              </div>
              <div class="flex gap-2">
                <button type="button" class="save-template-btn px-3 py-1.5 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700" data-template="order_confirmation">Save</button>
                <button type="button" class="preview-template-btn px-3 py-1.5 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50" data-template="order_confirmation">Preview</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Shipping Notification -->
        <div class="border border-gray-200 rounded-lg">
          <button type="button" class="template-toggle w-full flex items-center justify-between p-4 text-left" data-template="shipping_notification">
            <div>
              <span class="font-medium text-gray-900">Shipping Notification</span>
              <p class="text-sm text-gray-500">Sent when an order is shipped</p>
            </div>
            <svg class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="template-content hidden p-4 border-t border-gray-200 bg-gray-50">
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                <input type="text" name="email_shipping_notification_subject" class="w-full border-gray-300 rounded-lg text-sm" value="Your order #{{order_id}} has shipped!" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Body</label>
                <textarea name="email_shipping_notification_body" rows="6" class="w-full border-gray-300 rounded-lg text-sm font-mono">Hi {{customer_name}},

Great news! Your order #{{order_id}} is on its way!

Tracking Number: {{tracking_number}}
Carrier: {{carrier}}

Track your package: {{tracking_url}}

Thanks for shopping with us!</textarea>
              </div>
              <div class="flex gap-2">
                <button type="button" class="save-template-btn px-3 py-1.5 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700" data-template="shipping_notification">Save</button>
                <button type="button" class="preview-template-btn px-3 py-1.5 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50" data-template="shipping_notification">Preview</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Review Invitation -->
        <div class="border border-gray-200 rounded-lg">
          <button type="button" class="template-toggle w-full flex items-center justify-between p-4 text-left" data-template="review_invitation">
            <div>
              <span class="font-medium text-gray-900">Review Invitation</span>
              <p class="text-sm text-gray-500">Sent after order delivery to request a review</p>
            </div>
            <svg class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="template-content hidden p-4 border-t border-gray-200 bg-gray-50">
            <div class="space-y-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                <input type="text" name="email_review_invitation_subject" class="w-full border-gray-300 rounded-lg text-sm" value="How was your order? Leave a review!" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Body</label>
                <textarea name="email_review_invitation_body" rows="6" class="w-full border-gray-300 rounded-lg text-sm font-mono">Hi {{customer_name}},

We hope you're enjoying your purchase! We'd love to hear your feedback.

Click below to leave a review:
{{review_url}}

Your feedback helps other customers and helps us improve.

Thanks!</textarea>
              </div>
              <div class="flex gap-2">
                <button type="button" class="save-template-btn px-3 py-1.5 bg-primary-600 text-white text-sm rounded-lg hover:bg-primary-700" data-template="review_invitation">Save</button>
                <button type="button" class="preview-template-btn px-3 py-1.5 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50" data-template="review_invitation">Preview</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="bg-white rounded-xl shadow-sm border border-red-200 p-6">
      <h2 class="text-lg font-semibold text-red-600 mb-4">Danger Zone</h2>
      
      <div class="space-y-4">
        <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg">
          <div>
            <p class="font-medium text-gray-900">Clear All Conversations</p>
            <p class="text-sm text-gray-500">Delete all AI chat history</p>
          </div>
          <button id="clear-chats-btn" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors">
            Clear
          </button>
        </div>

        <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg">
          <div>
            <p class="font-medium text-gray-900">Reset Knowledge Base</p>
            <p class="text-sm text-gray-500">Delete all knowledge entries</p>
          </div>
          <button id="reset-kb-btn" class="px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors">
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = import.meta.env.PUBLIC_API_URL || '';

    async function updateSetting(key: string, value: any) {
      const res = await fetch(`${API_URL}/api/settings`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ key, value }),
      });
      return res.ok;
    }

    // Store settings form
    document.getElementById('store-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      
      const results = await Promise.all([
        updateSetting('store_name', formData.get('store_name')),
        updateSetting('notify_email', formData.get('notify_email')),
      ]);
      
      if (results.every(Boolean)) {
        alert('Settings saved!');
      } else {
        alert('Failed to save some settings');
      }
    });

    // AI toggle
    document.getElementById('ai-toggle')?.addEventListener('change', async (e) => {
      const enabled = (e.target as HTMLInputElement).checked;
      await updateSetting('ai_enabled', enabled);
    });

    // AI settings form
    document.getElementById('ai-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      
      const keywords = (formData.get('ai_handoff_keywords') as string)
        .split(',')
        .map(k => k.trim())
        .filter(Boolean);
      
      const results = await Promise.all([
        updateSetting('ai_welcome_message', formData.get('ai_welcome_message')),
        updateSetting('ai_system_prompt', formData.get('ai_system_prompt')),
        updateSetting('ai_handoff_keywords', keywords),
      ]);
      
      if (results.every(Boolean)) {
        alert('AI settings saved!');
      } else {
        alert('Failed to save some settings');
      }
    });

    // Payment settings form
    document.getElementById('payment-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      
      const paymentMethods = formData.getAll('payment_methods') as string[];
      
      const results = await Promise.all([
        updateSetting('currency', formData.get('currency')),
        updateSetting('stripe_public_key', formData.get('stripe_public_key')),
        updateSetting('payment_methods', paymentMethods),
      ]);
      
      if (results.every(Boolean)) {
        alert('Payment settings saved!');
      } else {
        alert('Failed to save some settings');
      }
    });

    // Shipping settings form
    document.getElementById('shipping-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target as HTMLFormElement;
      const formData = new FormData(form);
      
      const shippingCountries = formData.getAll('shipping_countries') as string[];
      const defaultCost = parseFloat(formData.get('shipping_default_cost') as string) || 0;
      const freeThreshold = parseFloat(formData.get('shipping_free_threshold') as string) || 0;
      
      const results = await Promise.all([
        updateSetting('shipping_default_cost', defaultCost),
        updateSetting('shipping_free_threshold', freeThreshold),
        updateSetting('shipping_estimate', formData.get('shipping_estimate')),
        updateSetting('shipping_countries', shippingCountries),
      ]);
      
      if (results.every(Boolean)) {
        alert('Shipping settings saved!');
      } else {
        alert('Failed to save some settings');
      }
    });

    // Danger zone
    document.getElementById('clear-chats-btn')?.addEventListener('click', async () => {
      if (!confirm('Are you sure? This will delete ALL chat conversations.')) return;
      // Would need a backend endpoint for this
      alert('Feature not yet implemented');
    });

    document.getElementById('reset-kb-btn')?.addEventListener('click', async () => {
      if (!confirm('Are you sure? This will delete ALL knowledge base entries.')) return;
      // Would need a backend endpoint for this
      alert('Feature not yet implemented');
    });

    // Email template toggles
    document.querySelectorAll('.template-toggle').forEach((btn) => {
      btn.addEventListener('click', () => {
        const content = btn.nextElementSibling;
        const icon = btn.querySelector('svg');
        content?.classList.toggle('hidden');
        icon?.classList.toggle('rotate-180');
      });
    });

    // Save email templates
    document.querySelectorAll('.save-template-btn').forEach((btn) => {
      btn.addEventListener('click', async () => {
        const template = (btn as HTMLElement).dataset.template;
        const subjectInput = document.querySelector(`input[name="email_${template}_subject"]`) as HTMLInputElement;
        const bodyInput = document.querySelector(`textarea[name="email_${template}_body"]`) as HTMLTextAreaElement;
        
        if (!subjectInput || !bodyInput) return;
        
        const results = await Promise.all([
          updateSetting(`email_${template}_subject`, subjectInput.value),
          updateSetting(`email_${template}_body`, bodyInput.value),
        ]);
        
        if (results.every(Boolean)) {
          alert('Template saved!');
        } else {
          alert('Failed to save template');
        }
      });
    });

    // Preview email templates
    document.querySelectorAll('.preview-template-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        const template = (btn as HTMLElement).dataset.template;
        const subjectInput = document.querySelector(`input[name="email_${template}_subject"]`) as HTMLInputElement;
        const bodyInput = document.querySelector(`textarea[name="email_${template}_body"]`) as HTMLTextAreaElement;
        
        if (!subjectInput || !bodyInput) return;
        
        // Replace variables with sample data
        const sampleData: Record<string, string> = {
          '{{customer_name}}': 'John Doe',
          '{{order_id}}': 'ORD-12345',
          '{{order_total}}': '$99.99',
          '{{tracking_number}}': '1Z999AA10123456784',
          '{{carrier}}': 'UPS',
          '{{tracking_url}}': 'https://example.com/track/1Z999AA10123456784',
          '{{review_url}}': 'https://example.com/review?order=12345',
        };
        
        let subject = subjectInput.value;
        let body = bodyInput.value;
        
        Object.entries(sampleData).forEach(([key, value]) => {
          subject = subject.replace(new RegExp(key.replace(/[{}]/g, '\\$&'), 'g'), value);
          body = body.replace(new RegExp(key.replace(/[{}]/g, '\\$&'), 'g'), value);
        });
        
        // Show preview in a new window
        const previewWindow = window.open('', '_blank', 'width=600,height=500');
        if (previewWindow) {
          previewWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>Email Preview</title>
              <style>
                body { font-family: system-ui, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
                .subject { font-weight: bold; font-size: 18px; border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 20px; }
                .body { white-space: pre-wrap; line-height: 1.6; }
              </style>
            </head>
            <body>
              <div class="subject">Subject: ${subject}</div>
              <div class="body">${body}</div>
            </body>
            </html>
          `);
          previewWindow.document.close();
        }
      });
    });
  </script>
</AdminLayout>
